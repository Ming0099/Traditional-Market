<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <link rel="stylesheet" href="css/infostyle.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=East+Sea+Dokdo&family=Black+Han+Sans&family=Gothic+A1&family=Noto+Sans+KR&display=swap" rel="stylesheet">
    <title>Document</title>
    <script 
        src="https://kit.fontawesome.com/9f8bb06fc7.js" 
        crossorigin="anonymous"
    ></script>
    <script src="/socket.io/socket.io.js"></script>
    <!--파이어베이스-->
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyD9vjq1SNxxTM2PB6xrTyBMPdzRZswqpTk",
          authDomain: "vacation2023-2.firebaseapp.com",
          projectId: "vacation2023-2",
          storageBucket: "vacation2023-2.appspot.com",
          messagingSenderId: "617591015177",
          appId: "1:617591015177:web:034f4f010626b8c95ff5d8"
        };
      
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
    </script>
    <script>
        var shoppingbasket = {}; // 장바구니
        const menuTag = ['곡물류','채소류','과일류','견과류','수산물','축산물','반찬','분식','중식','통닭','디저트','기타'];
        var marketname = '삼방시장'; // 회원가입 완료후 수정 필요
        var data;
        var restaurantID;

        window.onload = function(){
            var temp = window.location.search.split('=')[1];
            restaurantID = temp.split(',');
            var storeName = decodeURI(restaurantID[1]).replace( /_/gi, ' ');

            const db = firebase.firestore();
            db.collection('전통시장').doc(marketname).collection(menuTag[restaurantID[0]-1]).doc(storeName).get().then((result)=>{
                data = result.data();
                
                $('#titleImg').attr('src',data['imgurl']);
                $('#Title').text(storeName);
                $('#tip').text('배달팁 ' + data['tip'].toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',')); // 숫자 콤마 변환 정규식
                $('#minimumAmount').text('최소주문 ' + data['minamount'].toString().replace(/\B(?=(\d{3})+(?!\d))/g, ','));
                $('#rate').text(data['rate']);
                $('#reviewcount').text('리뷰 ' + data['review']['size'] + '개');
                $('#timerange').text(' ' + data['mintime'] + ' ~ ' + data['maxtime'] + '분');

                var str = "";
                for(let i=0; i<data['menu'].length; i++){
                    str += '<div class="menuBox">'
                        +'<div class="menuinfoBox">'
                            +'<label id="menutitle"><b>' + data['menu'][i]['name'] + '</b></label>'
                            +'<br>'
                            +'<label id="menuinfo">' + data['menu'][i]['info'] + '</label>'
                            +'<br><br>'
                            +'<label id="menuprice"><b>' + data['menu'][i]['price'].toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',') + '원</b></label>'
                            +'<button id=' + i + ' onclick="plus(this.id)"><b>+</b></button>'
                            +'<button id=' + i + ' onclick="minus(this.id)"><b>−</b></button>'
                            +'<input id="count' + i + '" value=0>'
                        +'</div>'
                        +'<div class="menuimageBox">'
                            +'<img src="' + data['menu'][i]['imgurl'] + '">'
                        +'</div>'
                    +'</div>';
                }
                $(str).appendTo('.menu');
            });
        }
        function plus(data){
            var value = $('#count'+data).val();
            $('#count'+data).val(Number(value)+1);
        }
        function minus(data){
            var value = $('#count'+data).val();
            if(Number(value) > 0){
                $('#count'+data).val(Number(value)-1);
            }
        }
    </script>
</head>
<body>
    <!--상단바-->
    <nav class="navbar">
        <div class="slidemenu">
            <input type="checkbox" id="slidemenuicon">

            <label for="slidemenuicon">
                <span></span>
                <span></span>
                <span></span>
            </label>

            <div class="sidebar">
                <ul>
                    <li>
                        <a href="#"><i class="fa-solid fa-motorcycle"></i> 배달현황</a>
                    </li>

                    <li>
                      <a href="#"><i class="fa-solid fa-cart-shopping"></i> 구매내역</a>
                    </li>
                    
                    <li>
                      <a href="#"><i class="fa-solid fa-heart"></i> 찜목록</a>
                    </li>

                    <li>
                        <a href="#"><i class="fa-solid fa-pen"></i> 남긴리뷰</a>
                    </li>
                  </ul>
            </div>
        </div>

        <div class="logo">
            <li><a href="/m"><i class="fa-solid fa-bowl-food"></i> 전통시장 <i class="fa-solid fa-utensils"></i></a></li>
            
        </div>

        <ul class="user">
            <a href="/m/login"><i class="fa-solid fa-user fa-xl"></i></a>
        </ul>
    </nav>

    <!--메인-->
    <div class="mainbody">
        <div class="maininfo">
            <div class="imageBox">
                <img id="titleImg" src="">
            </div>
            <div class="infoBox">
                <br>
                <label id="Title">가게명</label>
                <br><br>
                <label id="tip">배달팁</label>
                <br>
                <label id="minimumAmount">최소주문금액</label>
                <br><br>
                <label id="star"><i class="fa-solid fa-star"></i></label>
                <label id="rate">별점</label>
                <a href="#"><b id="reviewcount">리뷰개수</b><i class="fa-solid fa-chevron-right"></i></a>
                <br>
                <label id="timeicon"><i class="fa-solid fa-motorcycle"></i></label>
                <label id="timerange">배달시간</label>
            </div>
        </div>

        <div class="menu">
            <div class="margin1"></div>
            <div class="menuTag">메뉴 소개</div>
            <!--메뉴 추가-->
        </div>

        <div class="orderBox">
            <div class="orderText">
                <label><i class="fa-solid fa-phone"></i>주문하기</label>
            </div>
        </div>
    </div>

</body>
</html>